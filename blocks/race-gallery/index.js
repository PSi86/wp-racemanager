(()=>{"use strict";const e=window.wp.blocks,r=window.wp.blockEditor,a=window.wp.components,t=window.wp.i18n,i=window.wp.element,l=window.wp.coreData,n=window.ReactJSXRuntime;(0,e.registerBlockType)("wp-racemanager/race-gallery",{title:(0,t.__)("Race Media Gallery","wp-racemanager"),icon:"images-alt2",category:"media",attributes:{mediaItems:{type:"array",default:[]}},edit({attributes:e,setAttributes:s}){const{mediaItems:d}=e,o=d.length>0,c=(0,r.useBlockProps)(),p=e=>{const r=Array.isArray(e)?e:e.toJSON();s({mediaItems:r.map((e=>e.id))})},m=()=>{if(!o)return!1;const e=new wp.shortcode({tag:"gallery",attrs:{ids:d.join(",")},type:"single"}),r=wp.media.gallery.attachments(e),a=new wp.media.model.Selection(r.models,{props:r.props.toJSON(),multiple:!0});return a.gallery=r.gallery,a.more().done((()=>{a.props.set({query:!1}),a.unmirror(),a.props.unset("orderby")})),a},g={context:"edit"};o&&(g.include=d,g.per_page=d.length);const w=(0,l.useEntityRecords)("postType","attachment",g)||{},y=w.records,u=w.isResolving;if(o&&u)return(0,n.jsx)("div",{...c,children:(0,n.jsx)(a.Spinner,{})});const h=Array.isArray(y)?y.slice().sort(((e,r)=>d.indexOf(e.id)-d.indexOf(r.id))):[];return(0,n.jsx)(i.Fragment,{children:(0,n.jsxs)("div",{...c,children:[(0,n.jsx)("h2",{className:"rm-gallery-headline",children:(0,t.__)("Gallery","wp-racemanager")}),o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"rm-gallery-wrapper",children:h.map((e=>{const r=e.media_details?.sizes?.medium?.source_url||e.media_details?.sizes?.thumbnail?.source_url||e.source_url;return(0,n.jsx)("div",{className:"rm-gallery-thumb",children:(0,n.jsx)("img",{src:r,alt:e.alt_text||""})},e.id)}))}),(0,n.jsx)("div",{style:{marginTop:16},children:(0,n.jsx)(a.Button,{variant:"primary",onClick:()=>{const e=wp.media({frame:"post",state:o?"gallery-edit":"gallery",multiple:!0,editing:!0,library:{type:["image","video"]},title:o?(0,t.__)("Edit Gallery or Add Media","wp-racemanager"):(0,t.__)("Select or Upload Media","wp-racemanager"),button:{text:(0,t.__)("Confirm","wp-racemanager")},selection:m()});e.on("update",p),e.open()},children:(0,t.__)("Edit Gallery / Add Media","wp-racemanager")})})]}):(0,n.jsx)(r.MediaPlaceholder,{icon:"images-alt2",labels:{title:(0,t.__)("Gallery","wp-racemanager"),instructions:(0,t.__)("Drag and drop images, upload, or choose from your library.","wp-racemanager")},onSelect:p,allowedTypes:["image","video"],accept:"image/*,video/*",multiple:"add",gallery:!0}),(0,n.jsx)("style",{children:"\n            .rm-gallery-wrapper {\n              display: flex;\n              flex-wrap: wrap;\n              gap: 10px;\n            }\n            .rm-gallery-thumb img {\n              width: 150px;\n              height: 150px;\n              object-fit: cover;\n              border-radius: 3px;\n            }\n          "})]})})},save:()=>null})})();